import{m as W}from"./VSelect.93e2d2df.js";import{at as X,c as x,R as Y,av as Q,aV as q,aj as ee,ak as te,as as le,a as _,n as j,w as B,q as R,y as ne,z as s,F as Z,A as O,Z as ae}from"./main.78b17f62.js";import{m as ue}from"./transition.88a89596.js";import{f as oe}from"./forwardRefs.54bb1675.js";import{u as re,V as se,a as z}from"./VList.4ad28452.js";import{m as ie,f as ce,V as fe}from"./VTextField.db80de25.js";import{V as ve}from"./VMenu.54b2c8f2.js";import{V as de}from"./VCheckboxBtn.5ee340c9.js";import{V as me}from"./variant.0ba62894.js";import{V as pe}from"./VChip.138758bf.js";const he=(e,a,t)=>e==null||a==null?-1:e.toString().toLocaleLowerCase().indexOf(a.toString().toLocaleLowerCase()),ye=X({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Ve(e,a,t){var p,F;const y=[],V=(p=t==null?void 0:t.default)!=null?p:he,v=t!=null&&t.filterKeys?Q(t.filterKeys):!1,d=Object.keys((F=t==null?void 0:t.customKeyFilter)!=null?F:{}).length;if(!(e!=null&&e.length))return y;e:for(let C=0;C<e.length;C++){const n=e[C],i={},h={};let c=-1;if(a&&!(t!=null&&t.noFilter)){if(typeof n=="object"){const T=v||Object.keys(n);for(const k of T){var r;const A=q(n,k,n),w=t==null||(r=t.customKeyFilter)==null?void 0:r[k];if(c=w?w(A,a,n):V(A,a,n),c!==-1&&c!==!1)w?i[k]=c:h[k]=c;else if((t==null?void 0:t.filterMode)==="every")continue e}}else c=V(n,a,n),c!==-1&&c!==!1&&(h.title=c);const I=Object.keys(h).length,g=Object.keys(i).length;if(!I&&!g||(t==null?void 0:t.filterMode)==="union"&&g!==d&&!I||(t==null?void 0:t.filterMode)==="intersection"&&(g!==d||!I))continue}y.push({index:C,matches:{...h,...i}})}return y}function ge(e,a,t){const y=x(()=>typeof(t==null?void 0:t.value)!="string"&&typeof(t==null?void 0:t.value)!="number"?"":String(t.value));return{filteredItems:x(()=>{const v=Y(a);return Ve(v,y.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).map(r=>{let{index:p,matches:F}=r;return{item:v[p],matches:F}})})}}function ke(e,a,t){if(Array.isArray(a))throw new Error("Multiple matches is not implemented");return typeof a=="number"&&~a?s(Z,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,a)]),s("span",{class:"v-autocomplete__mask"},[e.substr(a,t)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(a+t)])]):e}const Ke=ee()({name:"VAutocomplete",props:{search:String,...ye({filterKeys:["title"]}),...W(),...te(ie({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...ue({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,a){let{slots:t}=a;const{t:y}=le(),V=_(),v=_(!1),d=_(!0),r=j(e,"menu"),{items:p,transformIn:F,transformOut:C}=re(e),n=j(e,"search",""),i=j(e,"modelValue",[],l=>F(Q(l)),l=>{var o;const u=C(l);return e.multiple?u:(o=u[0])!=null?o:null}),{filteredItems:h}=ge(e,p,x(()=>d.value?void 0:n.value)),c=x(()=>i.value.map(l=>p.value.find(u=>u.value===l.value)||l)),I=x(()=>c.value.map(l=>l.props.value)),g=_();function T(l){i.value=[],e.openOnClear&&(r.value=!0),n.value=""}function k(){e.hideNoData&&!p.value.length||e.readonly||(r.value=!0)}function A(l){if(!e.readonly){if(["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(d.value=!0),l.key==="ArrowDown"){var u;l.preventDefault(),(u=g.value)==null||u.focus("next")}else if(l.key==="ArrowUp"){var o;l.preventDefault(),(o=g.value)==null||o.focus("prev")}}}function w(l){n.value=l.target.value}function $(){v.value&&(d.value=!0)}function G(l){v.value=!0}function H(l){if(l.relatedTarget==null){var u;(u=V.value)==null||u.focus()}}const b=_(!1);function K(l){if(e.multiple){const u=I.value.findIndex(o=>o===l.value);if(u===-1)i.value=[...i.value,l],n.value="";else{const o=[...i.value];o.splice(u,1),i.value=o}}else i.value=[l],b.value=!0,t.selection||(n.value=l.title),r.value=!1,d.value=!0,R(()=>b.value=!1)}return B(v,l=>{var o;if(l){var u;b.value=!0,n.value=e.multiple||!!t.selection?"":String((o=(u=c.value.at(-1))==null?void 0:u.props.title)!=null?o:""),d.value=!0,R(()=>b.value=!1)}else r.value=!1,n.value=""}),B(n,l=>{!v.value||b.value||(l&&(r.value=!0),d.value=!l)}),ne(()=>{const l=!!(e.chips||t.chip),[u]=ce(e);return s(fe,O({ref:V},u,{modelValue:n.value,"onUpdate:modelValue":o=>{o==null&&(i.value=[])},validationValue:i.externalValue,dirty:i.value.length>0,onInput:w,class:["v-autocomplete",{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!t.selection}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":T,"onClick:control":k,"onClick:input":k,onFocus:()=>v.value=!0,onBlur:()=>v.value=!1,onKeydown:A}),{...t,default:()=>{var o,E,N;return s(Z,null,[s(ve,O({modelValue:r.value,"onUpdate:modelValue":f=>r.value=f,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:$},e.menuProps),{default:()=>[s(se,{ref:g,selected:I.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:f=>f.preventDefault(),onFocusin:G,onFocusout:H},{default:()=>{var f;return[!h.value.length&&!e.hideNoData&&((f=(o=t["no-data"])==null?void 0:o.call(t))!=null?f:s(z,{title:y(e.noDataText)},null)),(E=t["prepend-item"])==null?void 0:E.call(t),h.value.map((M,L)=>{var U;var P;let{item:m,matches:J}=M;return(U=(P=t.item)==null?void 0:P.call(t,{item:m,index:L,props:O(m.props,{onClick:()=>K(m)})}))!=null?U:s(z,O({key:L},m.props,{onClick:()=>K(m)}),{prepend:S=>{let{isSelected:D}=S;return e.multiple&&!e.hideSelected?s(de,{modelValue:D,ripple:!1},null):void 0},title:()=>{var D;var S;return d.value?m.title:ke(m.title,J.title,(D=(S=n.value)==null?void 0:S.length)!=null?D:0)}})}),(N=t["append-item"])==null?void 0:N.call(t)]}})]}),c.value.map((f,M)=>{function L(m){m.stopPropagation(),m.preventDefault(),K(f)}const P={"onClick:close":L,modelValue:!0,"onUpdate:modelValue":void 0};return s("div",{key:f.value,class:"v-autocomplete__selection"},[l?s(me,{defaults:{VChip:{closable:e.closableChips,size:"small",text:f.title}}},{default:()=>[t.chip?t.chip({item:f,index:M,props:P}):s(pe,P,null)]}):t.selection?t.selection({item:f,index:M}):s("span",{class:"v-autocomplete__selection-text"},[f.title,e.multiple&&M<c.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[ae(",")])])])})])}})}),oe({isFocused:v,isPristine:d,menu:r,search:n,filteredItems:h,select:K},V)}});export{Ke as V};
